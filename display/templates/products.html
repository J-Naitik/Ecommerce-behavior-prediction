{% extends "base.html" %}

{% block title %}Products - Browse All{% endblock %}

{% block content %}
<div class="products-section">
    <h1>Browse All Products</h1>
    
    <div class="filter-container">
        <div class="filter-box">
            <h3>Filters</h3>
            
            <div class="filter-group">
                <label for="categoryFilter">Category:</label>
                <select id="categoryFilter" onchange="applyFilters()">
                    <option value="all">All Categories</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="priceSort">Sort By:</label>
                <select id="priceSort" onchange="applyFilters()">
                    <option value="name">Product Name</option>
                    <option value="price_asc">Price: Low to High</option>
                    <option value="price_desc">Price: High to Low</option>
                </select>
            </div>

            <div class="filter-group">
                <label for="minPrice">Min Price: $<span id="minPriceValue">0</span></label>
                <input 
                    type="range" 
                    id="minPrice" 
                    min="0" 
                    max="1000" 
                    value="0" 
                    onchange="applyFilters()"
                    class="slider"
                >
            </div>

            <div class="filter-group">
                <label for="maxPrice">Max Price: $<span id="maxPriceValue">1000</span></label>
                <input 
                    type="range" 
                    id="maxPrice" 
                    min="0" 
                    max="1000" 
                    value="1000" 
                    onchange="applyFilters()"
                    class="slider"
                >
            </div>
        </div>

        <div class="products-display" id="productsDisplay">
            <p class="loading">Loading products...</p>
        </div>
    </div>
</div>

<script>
function applyFilters() {
    const category = document.getElementById('categoryFilter').value;
    const minPrice = document.getElementById('minPrice').value;
    const maxPrice = document.getElementById('maxPrice').value;
    const sortBy = document.getElementById('priceSort').value;

    document.getElementById('minPriceValue').textContent = minPrice;
    document.getElementById('maxPriceValue').textContent = maxPrice;

    const params = new URLSearchParams();
    if (category && category !== 'all') params.append('category', category);
    params.append('min_price', minPrice);
    params.append('max_price', maxPrice);
    params.append('sort_by', sortBy);

    fetch(`/api/products?${params}`)
        .then(response => response.json())
        .then(data => {
            displayProducts(data);
        })
        .catch(error => {
            document.getElementById('productsDisplay').innerHTML = `<p class="error-message">Error loading products</p>`;
        });
}

function displayProducts(products) {
    const container = document.getElementById('productsDisplay');
    
    if (products.length === 0) {
        container.innerHTML = '<p class="no-results">No products found</p>';
        return;
    }

    let html = `<div class="results-header"><h2>${products.length} Products Found</h2></div><div class="products-grid">`;

    products.forEach(product => {
        html += `
        <div class="product-card">
            <div class="product-header">
                <h3>${product.product_name || 'Product ' + product.product_id}</h3>
            </div>
            <div class="product-details">
                <p><strong>ID:</strong> ${product.product_id}</p>
                <p><strong>Category:</strong> ${product.category || 'N/A'}</p>
                <p class="product-price"><strong>Price:</strong> $${parseFloat(product.price || 0).toFixed(2)}</p>
            </div>
        </div>`;
    });

    html += '</div>';
    container.innerHTML = html;
}

// Load initial products
window.addEventListener('load', applyFilters);
</script>
